<!DOCTYPE html>
<html lang="ko">
<head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E9H56PTQKX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-E9H56PTQKX');
</script>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>낯선 사람과 랜덤 채팅</title>
<meta name="description" content="낯선 사람과 랜덤 채팅" />

<!-- Favicon & Preview -->
<link rel="icon" type="image/x-icon" href="https://chat-with-stranger.com/favicon.ico" />
<meta property="og:type" content="website" />
<meta property="og:title" content="낯선 사람과 랜덤 채팅" />
<meta property="og:description" content="낯선 사람과 랜덤 채팅" />
<meta property="og:image" content="https://chat-with-stranger.com/preview.jpg" />
<meta property="og:url" content="https://chat-with-stranger.com/" />
<meta property="og:site_name" content="chat-with-stranger.com" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="낯선 사람과 랜덤 채팅" />
<meta name="twitter:description" content="낯선 사람과 랜덤 채팅" />
<meta name="twitter:image" content="https://chat-with-stranger.com/preview.jpg" />

<!-- PayPal SDK (Live client-id 교체 가능) -->
<script src="https://www.paypal.com/sdk/js?client-id=AW41UQ3EzJV10FZHqYPy8yqdlDbklB4VjuT6hzu7DVoS-G9cJgKx9nHfxCRZpVSgs1dczhkPj4oM0VXv&currency=USD" defer></script>

<style>
  :root { --fg:#000; --bg:#fff; --border:#111; --hotpink:#ff1493; }
  * { box-sizing: border-box; }
  html, body { height:100%; margin:0; background:var(--bg); color:var(--fg); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
  header {
    position: sticky; top:0; z-index:20; background:#fff; border-bottom:1px solid var(--border);
    display:flex; align-items:center; justify-content:space-between; padding:12px 14px;
  }
  /* 헤더 타이틀: 텍스트 링크 */
  .site-title {
    font-weight:800; letter-spacing:-0.01em; font-size:16px; text-decoration:none; color:#000;
    padding:0; border:none; background:transparent; cursor:pointer;
  }
  .site-title:hover { text-decoration:underline; }

  .hamburger { width:40px; height:36px; display:grid; place-items:center; border:1px solid var(--fg); border-radius:8px; background:#fff; cursor:pointer; }
  .hamburger span { display:block; width:18px; height:2px; background:#000; position:relative; }
  .hamburger span::before, .hamburger span::after { content:""; position:absolute; left:0; width:18px; height:2px; background:#000; }
  .hamburger span::before { top:-6px; } .hamburger span::after { top:6px; }
  .menu {
    position:absolute; right:10px; top:54px; background:#fff; border:1px solid var(--border); border-radius:10px; box-shadow:0 8px 20px rgba(0,0,0,.08);
    display:none; min-width:240px; overflow:hidden;
  }
  .menu a { display:block; padding:12px 14px; text-decoration:none; color:#000; border-bottom:1px solid #eee; font-size:14px; }
  .menu a:last-child { border-bottom:none; }
  .menu a:hover { background:#f4f4f4; }

  main { display:flex; flex-direction:column; height:calc(100svh - 0px); }
  .toolbar {
    display:flex; gap:8px; padding:10px 14px; border-bottom:1px solid var(--border);
    position:sticky; top:52px; z-index:10; background:#fff;
  }
  .btn {
    padding:10px 12px; border:1px solid #000; background:#000; color:#fff; border-radius:10px; font-weight:700; font-size:14px; cursor:pointer;
  }
  .btn.secondary { background:#fff; color:#000; }
  /* no ads 버튼: 핫핑크 배경 + 검은 텍스트(기존 adult 스타일 유지) */
  .btn.noads {
    background: var(--hotpink);
    color: #000;
    border-color: var(--hotpink);
  }
 
	.chat {
    flex:1; overflow:auto; padding:14px; line-height:1.5; font-size:15px; white-space:pre-wrap;
  }
  .line { margin:6px 0; }
  .who { font-weight:700; }
  .me { }
  .str { }

  .input-wrap {
    position:sticky; bottom:60px; /* banner 50 + padding */
    background:#fff; border-top:1px solid var(--border); padding:8px 10px; display:flex; gap:8px; z-index:9;
  }
  .input-wrap input {
    flex:1; font-size:16px; padding:12px 12px; border:1px solid #000; border-radius:10px; background:#fff; color:#000;
  }
  .input-wrap button { padding:12px 14px; border:1px solid #000; background:#000; color:#fff; border-radius:10px; font-weight:700; }

  footer { position:sticky; bottom:0; border-top:1px solid #000; background:#fff; padding:6px 0; display:flex; justify-content:center; z-index:8; }
  .ad-slot { min-height:50px; width:100%; display:flex; justify-content:center; align-items:center; }

  /* PayPal modal */
  dialog#payModal { width:min(480px, 94vw); border:1px solid #000; border-radius:12px; padding:0; }
  .modal-head { padding:12px 14px; border-bottom:1px solid #000; font-weight:800; }
  .modal-body { padding:14px; }
  .modal-foot { padding:12px 14px; border-top:1px solid #000; text-align:right; }
  .close-btn { border:1px solid #000; background:#fff; padding:8px 12px; border-radius:8px; cursor:pointer; }

  @supports (height: 100svh) {
    main { height: calc(100svh - 0px); }
  }
</style>
</head>
<body>
<header>
  <a class="site-title" href="https://chat-with-stranger.com" target="_blank" rel="noopener">낯선 사람과 랜덤 채팅</a>
  <div style="position:relative">
    <button id="menuBtn" class="hamburger" aria-haspopup="menu" aria-expanded="false"><span></span></button>
    <nav id="menu" class="menu" role="menu" aria-label="빠른 링크">
      <a href="https://2048global.com/KR" target="_blank" rel="noopener">게임하기</a>
      <a href="https://t.me/lookingforglobalfriends" target="_blank" rel="noopener">글로벌 친구 TG 그룹</a>
      <a href="https://2048global.com/KR/vpn" target="_blank" rel="noopener">익명으로 전 세계 탐색</a>
      <a href="https://partner.bitget.com/bg/J6RM1E" target="_blank" rel="noopener">암호화폐 트레이딩</a>
    </nav>
  </div>
</header>

<main>
  <div class="toolbar">
    <button class="btn" id="newChatBtn">새 채팅</button>
    <!-- adults only → no ads -->
    <button class="btn noads" id="noAdsBtn">광고 제거</button>
    <button class="btn secondary" id="shareBtn">공유</button>
  </div>


  <div id="chat" class="chat" aria-live="polite" aria-label="채팅 창">
    <!-- lines appear here -->
  </div>

  <div class="input-wrap">
    <input id="msg" type="text" placeholder="여기에 입력..." enterkeyhint="send" />
    <button id="sendBtn">보내기</button>
  </div>

</main>


<!-- PayPal Modal -->
<dialog id="payModal">
  <div class="modal-head">광고 제거 (0.99 USD)</div>
  <div class="modal-body">
    <div id="paypal-buttons">PayPal 불러오는 중…</div>
    <p style="font-size:12px;opacity:.7;margin-top:12px">
      결제가 완료되면 chat-with-stranger.com/KO/noads 로 이동합니다
    </p>
  </div>
  <div class="modal-foot">
    <button class="close-btn" id="closePay">닫기</button>
  </div>
</dialog>

<script>
  // ------- helpers
  const lang = 'KO';
  const chatEl = document.getElementById('chat');
  const msgEl = document.getElementById('msg');
  const sendBtn = document.getElementById('sendBtn');
  const newChatBtn = document.getElementById('newChatBtn');
  const noAdsBtn = document.getElementById('noAdsBtn');
  const shareBtn = document.getElementById('shareBtn');

  const history = []; // {role:'user'|'assistant', content:string} list

  function addLine(who, text) {
    const line = document.createElement('div');
    line.className = 'line ' + (who === 'You' ? 'me' : 'str');
    line.textContent = who + ' : ' + text;
    chatEl.appendChild(line);
    chatEl.scrollTop = chatEl.scrollHeight;
  }

  // ------- initial: 50% AI starts
  window.addEventListener('load', async () => {
    setTimeout(() => {
      // handle mobile keyboard: ensure input visible
      msgEl.addEventListener('focus', () => setTimeout(() => {
        document.scrollingElement?.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
      }, 80));
    }, 0);

    if (Math.random() < 0.5) {
      // AI starts (adult endpoint)
      try {
        const r = await fetch('/api/chatadult', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ init: true, lang, history })
        });
        const data = await r.json();
        const text = (data.reply || '').trim();
        if (text) {
          history.push({ role: 'assistant', content: text });
          addLine('stranger', text);
        }
      } catch (e) {
        console.error(e);
      }
    }
  });

  // ------- send
  async function sendMessage() {
    const text = msgEl.value.trim();
    if (!text) return;
    msgEl.value = '';
    history.push({ role: 'user', content: text });
    addLine('You', text);

    try {
      const r = await fetch('/api/chatadult', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: text, history, lang })
      });
      const data = await r.json();
      const reply = (data.reply || '').trim();
      if (reply) {
        history.push({ role: 'assistant', content: reply });
        addLine('stranger', reply);
      }
    } catch (e) {
      console.error(e);
      addLine('stranger', '…연결이 끊겼습니다. 다시 시도해 주세요');
    }
  }

  sendBtn.addEventListener('click', sendMessage);
  msgEl.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      e.preventDefault(); sendMessage();
    }
  });

  // ------- toolbar buttons
  newChatBtn.addEventListener('click', () => location.reload());

  // share: base 도메인 공유
  shareBtn.addEventListener('click', async () => {
    const shareData = {
      title: '낯선 사람과 랜덤 채팅',
      text: '지금 들어와서 랜덤 채팅해요.',
      url: 'https://chat-with-stranger.com'
    };
    if (navigator.share) {
      try { await navigator.share(shareData); } catch {}
    } else {
      try {
        await navigator.clipboard.writeText(`${shareData.text} ${shareData.url}`);
        alert('링크가 복사되었습니다!');
      } catch { alert('이 링크를 복사하세요: ' + shareData.url); }
    }
  });

  // ------- hamburger menu
  const menuBtn = document.getElementById('menuBtn');
  const menu = document.getElementById('menu');
  menuBtn.addEventListener('click', () => {
    const open = menu.style.display === 'block';
    menu.style.display = open ? 'none' : 'block';
    menuBtn.setAttribute('aria-expanded', (!open).toString());
  });
  document.addEventListener('click', (e) => {
    if (!menu.contains(e.target) && e.target !== menuBtn) menu.style.display = 'none';
  });

  // ------- PayPal modal
  const payModal = document.getElementById('payModal');
  const closePay = document.getElementById('closePay');

  closePay.addEventListener('click', () => payModal.close());

  // no ads 클릭 시: 모달 오픈 + 결제 성공 후 /KO/noads로 이동
  let nextRedirect = 'https://chat-with-stranger.com/KO/noads';
  noAdsBtn.addEventListener('click', () => {
    nextRedirect = 'https://chat-with-stranger.com/KO/noads';
    payModal.showModal();
  });


  // PayPal Buttons 렌더
  window.addEventListener('load', () => {
    if (window.paypal && document.getElementById('paypal-buttons')) {
      window.paypal.Buttons({
        style: { layout: 'vertical', shape: 'rect', label: 'pay', color: 'black' },
        createOrder: function(data, actions) {
          return actions.order.create({
            purchase_units: [{ amount: { value: '0.99', currency_code: 'USD' }, description: 'Remove Ads - Adult Chat' }]
          });
        },
        onApprove: function(data, actions) {
          return actions.order.capture().then(function() {
            location.href = nextRedirect;
          });
        }
      }).render('#paypal-buttons');
    }
  });
</script>
</body>

</html>

